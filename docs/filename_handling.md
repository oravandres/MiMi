# Improved Filename Handling in MiMi

## Overview

This document describes improvements made to MiMi's file naming system to address issues with mangled or incorrect filenames being generated by AI agents.

## Problem

The MiMi agent system was experiencing issues with filenames in generated code, such as:

1. Files with poor naming like `pipe_.upperpipe_` instead of proper names like `pipe.css`
2. Lost CSS class selectors during code extraction, resulting in confusing filenames
3. Inconsistent handling of special characters and extensions
4. Inability to detect the appropriate file type from content

## Solution

We've implemented several enhancements to the `output_manager.py` module:

### 1. Enhanced Filename Sanitization

The `sanitize_filename()` function now includes:

- Special case handling for common patterns (e.g., `pipe_.upperpipe_` → `pipe.css`)
- Preservation of capitalization for component names (e.g., `upperPipe.css`)
- Smarter extension handling to avoid duplicated extensions (e.g., `file.css.css` → `file.css`)
- Context-aware extension inference (adding appropriate extensions based on content type)
- Preservation of multiple dots in filenames where appropriate (e.g., `file.with.dots.txt`)

### 2. Improved Code Block Extraction

The `extract_code_blocks()` function now includes:

- Preservation of original code block text for more context
- Special handling for CSS selectors that might be lost during extraction
- Multiple strategies for filename extraction:
  - Checking file headers and comments
  - Looking for CSS class/ID selectors
  - Examining content patterns to infer file types
  - Analyzing the original markdown code block
- Recovery mechanisms for fragmented CSS content

## Implementation Details

### Key Improvements

1. **CSS Selector Detection**: The system now examines the original code block text to find CSS selectors (e.g., `.bird {`), even if they're removed during the extraction process.

2. **Smart File Type Inference**: Content-based analysis detects appropriate file types based on code patterns:
   - CSS patterns: presence of properties like `margin`, `color`, etc.
   - HTML patterns: tag structures like `<tag></tag>`
   - JavaScript patterns: keywords like `function`, `const`, etc.

3. **Special Case Handling**: Explicit handling for common problematic patterns found in AI-generated code.

4. **Contextual Sanitization**: The sanitization process now considers content context when deciding how to process a filename.

## Testing

A comprehensive test suite has been created in `test_filename_fix.py` to verify the improved functionality:

- Tests for sanitizing problematic filenames
- Tests for extracting CSS code blocks with class selectors
- Tests for handling various special cases

All test cases pass successfully, confirming that the system now correctly handles previously problematic filenames.

## Future Improvements

While the current implementation addresses the immediate issues, some potential future enhancements include:

1. Machine learning-based filename prediction based on content
2. More comprehensive language/content type detection
3. User-configurable filename patterns and conventions
4. Integration with project-specific naming conventions 