# Agent Logging System

The Agent Logging System in MiMi provides detailed tracking of agent activities throughout the execution of multi-agent workflows. This documentation explains how to use the agent logging system, its features, and implementation details.

## Features

- **Comprehensive Activity Tracking**: Logs all agent actions with timestamps, input data, output data, and additional details
- **Multiple Log Formats**: Supports both Markdown and JSON formats
- **Asynchronous Logging**: Optional non-blocking asynchronous logging for improved performance
- **Structured Data Handling**: Properly handles complex data structures, multi-line text, and large payloads
- **Automatic File Organization**: Logs are stored in project directories with proper structure

## Log File Structure

### Markdown Format (agent.log.md)

The Markdown format creates a human-readable log file with the following structure:

```markdown
# Agent Activity Log

Project directory: /path/to/project

| Timestamp | Agent | Action | Input | Output | Details |
|-----------|-------|--------|-------|--------|---------|
| 2023-05-15 14:30:22 | researcher | analysis | Input data... | Output data... | key: value |
```

### JSON Format (agent.log.json)

The JSON format creates a structured log file that's easier to parse programmatically:

```json
{
  "logs": [
    {
      "timestamp": "2023-05-15 14:30:22",
      "agent": "researcher",
      "action": "analysis",
      "input": {...},
      "output": {...},
      "details": {...}
    }
  ]
}
```

## Usage

### Basic Usage

The simplest way to log agent activities is through the `Agent.log_to_agent_file()` method:

```python
agent.log_to_agent_file(
    project_dir=project_dir,
    action_type="analyze",
    input_summary="User query: How to implement feature X?",
    output_summary="Analysis results with recommendations",
    details={"duration": "2.5s", "confidence": 0.92}
)
```

### JSON Format Logging

To log in JSON format instead of Markdown:

```python
agent.log_to_agent_file(
    project_dir=project_dir,
    action_type="analyze",
    input_summary=complex_input_object,  # Can be any Python object
    output_summary=complex_output_object,
    details={"format": "json"},
    log_format="json"  # Specify JSON format
)
```

### Asynchronous Logging

For high-performance situations where logging should not block the main execution:

```python
agent.log_to_agent_file(
    project_dir=project_dir,
    action_type="analyze",
    input_summary="Input data",
    output_summary="Output data",
    details={"is_async": True},
    async_log=True  # Enable asynchronous logging
)
```

## Implementation Details

### Directory Structure

Agent logs are stored in the project directory structure:

```
Software/
└── project/
    └── project_name/
        ├── timestamp_directory/
        │   ├── agent.log.md     # Markdown format log
        │   └── agent.log.json   # JSON format log (if used)
        └── latest/ -> timestamp_directory/  # Symlink to latest version
```

### Agent Log Entry Fields

Each log entry includes:

- **Timestamp**: When the action occurred
- **Agent**: Name of the agent performing the action
- **Action**: Type of action being performed (e.g., analyze, generate, review)
- **Input**: Data provided to the agent
- **Output**: Results generated by the agent
- **Details**: Additional metadata about the action

### Data Handling

The logging system properly handles:

- Complex data structures (dictionaries, lists)
- Large text content (with intelligent summarization when needed)
- Multi-line text (preserving line breaks in Markdown)
- Special characters (escaping pipe characters in Markdown tables)

## Example

Here's a complete example of logging an agent action:

```python
from mimi.core.agent import Agent
from mimi.utils.output_manager import create_output_directory

# Create a project directory
project_dir = create_output_directory("MyProject")

# Create an agent
agent = Agent(
    name="analyst",
    role="Data Analyst",
    description="Analyzes data and provides insights",
    model_name="llama3-70b",
    model_provider="ollama"
)

# Log an action
agent.log_to_agent_file(
    project_dir=project_dir,
    action_type="data-analysis",
    input_summary={"dataset": "sales_data.csv", "query": "Find top performing products"},
    output_summary={"insights": ["Product A has highest margin", "Product B has most units sold"]},
    details={"duration": "1.2s", "processed_rows": 5000},
    log_format="json"  # Use JSON format
)
```

## Testing

You can test the agent logging functionality using the provided test scripts:

- `test_agent_log.py`: Basic agent logging test
- `test_full_logging.py`: Tests with large inputs/outputs
- `test_enhanced_logging.py`: Tests enhanced features (JSON format, async logging)

Run the tests with:

```bash
python test_enhanced_logging.py
``` 